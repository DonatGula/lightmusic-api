<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LightMusic API Explorer</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:        #080b10;
    --surface:   #0d1117;
    --card:      #111820;
    --border:    #1e2d3d;
    --accent:    #00d4ff;
    --accent2:   #ff6b35;
    --accent3:   #7dff8a;
    --text:      #cdd9e5;
    --muted:     #4a6070;
    --success:   #3fb950;
    --error:     #f85149;
    --warning:   #d29922;
    --mono:      'JetBrains Mono', monospace;
    --sans:      'Syne', sans-serif;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--sans);
    min-height: 100vh;
    display: grid;
    grid-template-columns: 300px 1fr;
    grid-template-rows: 56px 1fr;
    height: 100vh;
    overflow: hidden;
  }

  /* â”€â”€ TOPBAR â”€â”€ */
  .topbar {
    grid-column: 1 / -1;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 20px;
    gap: 16px;
    position: relative;
    z-index: 10;
  }
  .logo {
    display: flex; align-items: center; gap: 10px;
    font-size: 16px; font-weight: 800; color: #fff;
    letter-spacing: -0.5px;
  }
  .logo-icon {
    width: 28px; height: 28px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 14px;
  }
  .logo span { color: var(--accent); }

  .topbar-url {
    flex: 1;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 7px 14px;
    font-family: var(--mono);
    font-size: 12px;
    color: var(--accent3);
    display: flex; align-items: center; gap: 8px;
    overflow: hidden;
  }
  .topbar-url span { color: var(--muted); font-size: 11px; flex-shrink: 0; }
  .topbar-url .url-text {
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }

  .topbar-badge {
    padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700;
    background: #00d4ff15; color: var(--accent); border: 1px solid #00d4ff30;
    letter-spacing: 0.5px;
  }

  /* â”€â”€ SIDEBAR â”€â”€ */
  .sidebar {
    background: var(--surface);
    border-right: 1px solid var(--border);
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  .sidebar::-webkit-scrollbar { width: 4px; }
  .sidebar::-webkit-scrollbar-track { background: transparent; }
  .sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .sidebar-section { padding: 16px; border-bottom: 1px solid var(--border); }
  .sidebar-label {
    font-size: 10px; font-weight: 700; letter-spacing: 1.5px;
    color: var(--muted); text-transform: uppercase; margin-bottom: 10px;
  }

  /* Search box */
  .search-wrap { position: relative; }
  .search-input {
    width: 100%; background: var(--card); border: 1px solid var(--border);
    border-radius: 8px; padding: 9px 36px 9px 12px;
    font-family: var(--sans); font-size: 13px; color: var(--text);
    outline: none; transition: border-color 0.2s;
  }
  .search-input:focus { border-color: var(--accent); }
  .search-input::placeholder { color: var(--muted); }
  .search-btn {
    position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
    background: var(--accent); border: none; border-radius: 5px;
    width: 22px; height: 22px; cursor: pointer; color: #000;
    font-size: 11px; display: flex; align-items: center; justify-content: center;
  }

  /* Endpoint nav */
  .endpoint-item {
    display: flex; align-items: center; gap: 8px;
    padding: 9px 10px; border-radius: 8px; cursor: pointer;
    transition: background 0.15s; margin-bottom: 2px;
  }
  .endpoint-item:hover { background: var(--card); }
  .endpoint-item.active { background: #00d4ff10; border: 1px solid #00d4ff20; }
  .method-badge {
    padding: 2px 7px; border-radius: 4px; font-size: 10px;
    font-weight: 700; font-family: var(--mono); flex-shrink: 0;
  }
  .get  { background: #1f6feb20; color: #58a6ff; }
  .post { background: #f8514920; color: #f85149; }
  .endpoint-path { font-family: var(--mono); font-size: 12px; color: var(--text); }
  .endpoint-desc { font-size: 11px; color: var(--muted); margin-top: 1px; }

  /* Song ID input */
  .sid-input {
    width: 100%; background: var(--card); border: 1px solid var(--border);
    border-radius: 8px; padding: 8px 12px;
    font-family: var(--mono); font-size: 12px; color: var(--accent3);
    outline: none; transition: border-color 0.2s; margin-bottom: 6px;
  }
  .sid-input:focus { border-color: var(--accent3); }

  .country-select {
    width: 100%; background: var(--card); border: 1px solid var(--border);
    border-radius: 8px; padding: 8px 12px;
    font-family: var(--sans); font-size: 13px; color: var(--text);
    outline: none; cursor: pointer; margin-bottom: 6px;
  }

  .run-btn {
    width: 100%; padding: 10px; border: none; border-radius: 8px;
    background: linear-gradient(135deg, var(--accent), #0099bb);
    color: #000; font-family: var(--sans); font-size: 13px; font-weight: 700;
    cursor: pointer; transition: opacity 0.2s; display: flex;
    align-items: center; justify-content: center; gap: 6px;
  }
  .run-btn:hover { opacity: 0.85; }
  .run-btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .run-btn .spinner {
    width: 14px; height: 14px; border: 2px solid #00000040;
    border-top-color: #000; border-radius: 50%; animation: spin 0.6s linear infinite;
    display: none;
  }
  .run-btn.loading .spinner { display: block; }

  /* Quick songs */
  .quick-item {
    display: flex; align-items: center; gap: 8px;
    padding: 7px 8px; border-radius: 6px; cursor: pointer;
    transition: background 0.15s; margin-bottom: 2px;
  }
  .quick-item:hover { background: var(--card); }
  .quick-cover {
    width: 32px; height: 32px; border-radius: 4px;
    background: linear-gradient(135deg, #1e2d3d, #0d1117);
    flex-shrink: 0; overflow: hidden; display: flex;
    align-items: center; justify-content: center; font-size: 16px;
  }
  .quick-cover img { width: 100%; height: 100%; object-fit: cover; }
  .quick-title { font-size: 12px; color: var(--text); font-weight: 600; }
  .quick-artist { font-size: 11px; color: var(--muted); }

  /* â”€â”€ MAIN PANEL â”€â”€ */
  .main {
    display: grid;
    grid-template-rows: 1fr auto;
    overflow: hidden;
    position: relative;
  }

  .response-area {
    overflow-y: auto; padding: 20px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .response-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 12px;
  }
  .response-title {
    display: flex; align-items: center; gap: 8px;
    font-size: 13px; font-weight: 700; color: var(--muted);
    text-transform: uppercase; letter-spacing: 1px;
  }
  .response-title::before {
    content: '>_'; color: var(--accent); font-family: var(--mono);
  }

  .status-pill {
    padding: 3px 10px; border-radius: 12px; font-size: 11px;
    font-weight: 700; font-family: var(--mono);
  }
  .status-ok  { background: #3fb95020; color: var(--success); }
  .status-err { background: #f8514920; color: var(--error); }
  .status-load { background: #d2992220; color: var(--warning); }

  .response-meta {
    display: flex; gap: 16px; margin-bottom: 12px;
  }
  .meta-item {
    font-size: 11px; color: var(--muted); font-family: var(--mono);
  }
  .meta-item span { color: var(--text); }

  .json-block {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 10px; overflow: hidden;
  }
  .json-block-header {
    background: #ffffff04; padding: 8px 14px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid var(--border);
  }
  .json-block-header span { font-size: 11px; color: var(--muted); font-family: var(--mono); }
  .copy-btn {
    background: none; border: 1px solid var(--border); border-radius: 5px;
    color: var(--muted); font-size: 11px; padding: 3px 8px; cursor: pointer;
    font-family: var(--sans); transition: all 0.2s;
  }
  .copy-btn:hover { color: var(--text); border-color: var(--accent); }

  .json-content {
    padding: 16px; font-family: var(--mono); font-size: 12.5px;
    line-height: 1.7; overflow-x: auto; white-space: pre;
  }

  /* JSON syntax highlight */
  .jk { color: #79c0ff; }   /* key */
  .js { color: #a5d6ff; }   /* string value */
  .jn { color: #ff9e64; }   /* number */
  .jb { color: #ff7b72; }   /* boolean/null */
  .jp { color: #8b949e; }   /* punctuation */

  /* Empty state */
  .empty-state {
    display: flex; flex-direction: column; align-items: center;
    justify-content: center; height: 100%; gap: 12px; color: var(--muted);
  }
  .empty-icon { font-size: 48px; opacity: 0.3; }
  .empty-text { font-size: 14px; }
  .empty-sub  { font-size: 12px; opacity: 0.7; }

  /* â”€â”€ AUDIO PLAYER â”€â”€ */
  .player-bar {
    background: var(--surface);
    border-top: 1px solid var(--border);
    padding: 12px 20px;
    display: none;
    align-items: center;
    gap: 16px;
  }
  .player-bar.visible { display: flex; }

  .player-cover {
    width: 40px; height: 40px; border-radius: 6px; flex-shrink: 0;
    background: var(--card); overflow: hidden;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
  }
  .player-cover img { width: 100%; height: 100%; object-fit: cover; }

  .player-info { flex: 1; min-width: 0; }
  .player-title { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .player-artist { font-size: 11px; color: var(--muted); }

  .player-controls { display: flex; align-items: center; gap: 12px; }
  .ctrl-btn {
    background: none; border: none; color: var(--muted);
    font-size: 18px; cursor: pointer; transition: color 0.2s;
    width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
    border-radius: 50%;
  }
  .ctrl-btn:hover { color: var(--text); }
  .ctrl-btn.play {
    background: var(--accent); color: #000; font-size: 14px;
    width: 36px; height: 36px;
  }
  .ctrl-btn.play:hover { opacity: 0.85; }

  .player-progress { flex: 1; max-width: 200px; }
  .progress-track {
    height: 3px; background: var(--border); border-radius: 2px;
    cursor: pointer; position: relative; overflow: hidden;
  }
  .progress-fill {
    height: 100%; background: var(--accent); border-radius: 2px;
    width: 0%; transition: width 0.1s linear;
  }
  .player-time {
    display: flex; justify-content: space-between;
    font-size: 10px; color: var(--muted); font-family: var(--mono);
    margin-top: 3px;
  }

  .player-vol { display: flex; align-items: center; gap: 6px; }
  .vol-icon { font-size: 14px; color: var(--muted); }
  .vol-slider {
    -webkit-appearance: none; width: 70px; height: 3px;
    background: var(--border); border-radius: 2px; outline: none; cursor: pointer;
  }
  .vol-slider::-webkit-slider-thumb {
    -webkit-appearance: none; width: 12px; height: 12px;
    background: var(--accent); border-radius: 50%;
  }

  /* Animations */
  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes fadeIn { from { opacity:0; transform:translateY(4px); } to { opacity:1; transform:none; } }
  .fade-in { animation: fadeIn 0.3s ease; }

  .live-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--success); animation: pulse 2s infinite;
    display: inline-block;
  }
  @keyframes pulse {
    0%,100% { opacity:1; } 50% { opacity:0.3; }
  }
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="logo">
    <div class="logo-icon">ğŸµ</div>
    Light<span>Music</span>
  </div>
  <div class="topbar-url">
    <span>API URL</span>
    <div class="url-text" id="currentUrl">Pilih endpoint untuk mulai</div>
  </div>
  <span class="topbar-badge"><span class="live-dot"></span> LIVE</span>
</div>

<!-- SIDEBAR -->
<div class="sidebar">

  <!-- Search -->
  <div class="sidebar-section">
    <div class="sidebar-label">ğŸ” Pencarian</div>
    <div class="search-wrap">
      <input class="search-input" id="searchQuery" type="text" placeholder="Cari lagu, artis..." />
      <button class="search-btn" onclick="runSearch()">â–¶</button>
    </div>
  </div>

  <!-- Endpoints -->
  <div class="sidebar-section">
    <div class="sidebar-label">ğŸ“¡ Endpoints</div>
    <div class="endpoint-item" onclick="selectEndpoint('search')">
      <span class="method-badge get">GET</span>
      <div>
        <div class="endpoint-path">/search</div>
        <div class="endpoint-desc">Cari lagu & artis</div>
      </div>
    </div>
    <div class="endpoint-item" onclick="selectEndpoint('song')">
      <span class="method-badge get">GET</span>
      <div>
        <div class="endpoint-path">/song/:id</div>
        <div class="endpoint-desc">Detail metadata lagu</div>
      </div>
    </div>
    <div class="endpoint-item" onclick="selectEndpoint('stream')">
      <span class="method-badge get">GET</span>
      <div>
        <div class="endpoint-path">/stream/:id</div>
        <div class="endpoint-desc">Ambil URL stream audio</div>
      </div>
    </div>
    <div class="endpoint-item" onclick="selectEndpoint('play')">
      <span class="method-badge get">GET</span>
      <div>
        <div class="endpoint-path">/play/:id</div>
        <div class="endpoint-desc">Play audio langsung</div>
      </div>
    </div>
    <div class="endpoint-item" onclick="selectEndpoint('lyrics')">
      <span class="method-badge get">GET</span>
      <div>
        <div class="endpoint-path">/lyrics/:id</div>
        <div class="endpoint-desc">Lirik lagu</div>
      </div>
    </div>
    <div class="endpoint-item" onclick="selectEndpoint('charts')">
      <span class="method-badge get">GET</span>
      <div>
        <div class="endpoint-path">/charts</div>
        <div class="endpoint-desc">Top chart per negara</div>
      </div>
    </div>
  </div>

  <!-- Song ID -->
  <div class="sidebar-section">
    <div class="sidebar-label">ğŸµ Song / Video ID</div>
    <input class="sid-input" id="videoId" type="text" placeholder="contoh: kitkOTxGfjI" value="kitkOTxGfjI" />
    <button class="run-btn" id="runBtn" onclick="runEndpoint()">
      <span class="spinner" id="spinner"></span>
      <span id="runLabel">â–¶ Jalankan</span>
    </button>
  </div>

  <!-- Country -->
  <div class="sidebar-section">
    <div class="sidebar-label">ğŸŒ Chart Country</div>
    <select class="country-select" id="countrySelect">
      <option value="ID">ğŸ‡®ğŸ‡© Indonesia</option>
      <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
      <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
      <option value="KR">ğŸ‡°ğŸ‡· South Korea</option>
      <option value="GB">ğŸ‡¬ğŸ‡§ United Kingdom</option>
      <option value="AU">ğŸ‡¦ğŸ‡º Australia</option>
    </select>
  </div>

  <!-- Quick Songs -->
  <div class="sidebar-section">
    <div class="sidebar-label">âš¡ Quick Test</div>
    <div class="quick-item" onclick="quickPlay('kitkOTxGfjI','Separuh Nafas','Dewa 19')">
      <div class="quick-cover">ğŸµ</div>
      <div>
        <div class="quick-title">Separuh Nafas</div>
        <div class="quick-artist">Dewa 19</div>
      </div>
    </div>
    <div class="quick-item" onclick="quickPlay('kXQRVbRfF4s','Yellow','Coldplay')">
      <div class="quick-cover">ğŸŒŸ</div>
      <div>
        <div class="quick-title">Yellow</div>
        <div class="quick-artist">Coldplay</div>
      </div>
    </div>
    <div class="quick-item" onclick="quickPlay('5a0EkeqWNBs','Kangen','Dewa 19')">
      <div class="quick-cover">ğŸ’«</div>
      <div>
        <div class="quick-title">Kangen</div>
        <div class="quick-artist">Dewa 19</div>
      </div>
    </div>
  </div>

</div>

<!-- MAIN -->
<div class="main">

  <div class="response-area" id="responseArea">
    <div class="empty-state" id="emptyState">
      <div class="empty-icon">ğŸµ</div>
      <div class="empty-text">LightMusic API Explorer</div>
      <div class="empty-sub">Pilih endpoint di sidebar atau ketik pencarian untuk mulai</div>
    </div>
  </div>

  <!-- Audio Player -->
  <div class="player-bar" id="playerBar">
    <div class="player-cover" id="playerCover">ğŸµ</div>
    <div class="player-info">
      <div class="player-title" id="playerTitle">â€”</div>
      <div class="player-artist" id="playerArtist">â€”</div>
    </div>
    <div class="player-controls">
      <button class="ctrl-btn" onclick="seekBack()">â®</button>
      <button class="ctrl-btn play" id="playBtn" onclick="togglePlay()">â–¶</button>
      <button class="ctrl-btn" onclick="seekForward()">â­</button>
    </div>
    <div class="player-progress">
      <div class="progress-track" onclick="seekTo(event)">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="player-time">
        <span id="timeNow">0:00</span>
        <span id="timeDur">0:00</span>
      </div>
    </div>
    <div class="player-vol">
      <span class="vol-icon">ğŸ”Š</span>
      <input class="vol-slider" type="range" min="0" max="1" step="0.05" value="0.8" oninput="setVol(this.value)">
    </div>
  </div>

</div>

<audio id="audioEl"></audio>

<script>
  // â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const BASE = window.location.hostname === 'localhost' 
    ? 'http://localhost:5000'
    : 'https://lightmusic.up.railway.app';
  // Ganti dengan URL Railway kamu di atas â†‘

  let currentEndpoint = 'search';
  const audio = document.getElementById('audioEl');
  audio.volume = 0.8;

  // â”€â”€ ENDPOINT SELECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function selectEndpoint(ep) {
    currentEndpoint = ep;
    document.querySelectorAll('.endpoint-item').forEach(el => el.classList.remove('active'));
    event.currentTarget.classList.add('active');
  }

  // â”€â”€ RUN ENDPOINT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function runEndpoint() {
    const vid = document.getElementById('videoId').value.trim();
    const country = document.getElementById('countrySelect').value;
    const q = document.getElementById('searchQuery').value.trim();

    let url = '';
    switch(currentEndpoint) {
      case 'search':  url = `${BASE}/search?q=${encodeURIComponent(q||'dewa19')}&type=songs`; break;
      case 'song':    url = `${BASE}/song/${vid}`; break;
      case 'stream':  url = `${BASE}/stream/${vid}`; break;
      case 'play':    url = `${BASE}/play/${vid}`; playAudio(vid, 'Preview', ''); return;
      case 'lyrics':  url = `${BASE}/lyrics/${vid}`; break;
      case 'charts':  url = `${BASE}/charts?country=${country}`; break;
      default: url = BASE;
    }

    await fetchAndShow(url);
  }

  async function runSearch() {
    currentEndpoint = 'search';
    const q = document.getElementById('searchQuery').value.trim();
    if (!q) return;
    await fetchAndShow(`${BASE}/search?q=${encodeURIComponent(q)}&type=songs`);
  }

  async function fetchAndShow(url) {
    setLoading(true);
    document.getElementById('currentUrl').textContent = url;
    const start = Date.now();

    try {
      const res = await fetch(url);
      const elapsed = Date.now() - start;
      const data = await res.json();
      renderResponse(data, res.status, elapsed, url);

      // Auto-play jika ada stream_url
      if (data.data?.stream_url && data.data?.title) {
        setupPlayer(data.data.stream_url, data.data.title, '', data.data.thumbnail || '');
      }

      // Tampilkan hasil search sebagai quick items
      if (data.data && Array.isArray(data.data)) {
        renderSearchResults(data.data);
      }

    } catch(e) {
      renderError(e.message);
    } finally {
      setLoading(false);
    }
  }

  // â”€â”€ RENDER RESPONSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderResponse(data, status, ms, url) {
    const area = document.getElementById('responseArea');
    const isOk = status >= 200 && status < 300;
    const statusClass = isOk ? 'status-ok' : 'status-err';
    const statusLabel = isOk ? `âœ“ ${status} OK` : `âœ— ${status} ERROR`;

    area.innerHTML = `
      <div class="fade-in">
        <div class="response-header">
          <div class="response-title">JSON Response</div>
          <span class="status-pill ${statusClass}">${statusLabel}</span>
        </div>
        <div class="response-meta">
          <div class="meta-item">Waktu: <span>${ms}ms</span></div>
          <div class="meta-item">Size: <span>${JSON.stringify(data).length} bytes</span></div>
          <div class="meta-item">Endpoint: <span>${url.replace(BASE,'')}</span></div>
        </div>
        <div class="json-block">
          <div class="json-block-header">
            <span>application/json</span>
            <button class="copy-btn" onclick="copyJson()">Copy</button>
          </div>
          <div class="json-content" id="jsonContent">${syntaxHighlight(JSON.stringify(data, null, 2))}</div>
        </div>
      </div>`;

    window._lastJson = data;
  }

  function renderError(msg) {
    document.getElementById('responseArea').innerHTML = `
      <div class="fade-in">
        <div class="response-header">
          <div class="response-title">JSON Response</div>
          <span class="status-pill status-err">âœ— ERROR</span>
        </div>
        <div class="json-block">
          <div class="json-block-header"><span>error</span></div>
          <div class="json-content" style="color:var(--error)">${msg}</div>
        </div>
      </div>`;
  }

  function renderSearchResults(items) {
    // Update quick items di sidebar dengan hasil search
    const container = document.querySelector('.sidebar-section:last-child');
    if (!items.length) return;

    let html = '<div class="sidebar-label">ğŸ” Hasil Pencarian</div>';
    items.slice(0, 6).forEach(item => {
      html += `
        <div class="quick-item" onclick="quickPlay('${item.id}','${escHtml(item.title)}','${escHtml(item.artist)}')">
          <div class="quick-cover">
            ${item.thumbnail ? `<img src="${item.thumbnail}" onerror="this.style.display='none'">` : 'ğŸµ'}
          </div>
          <div>
            <div class="quick-title">${escHtml(item.title)}</div>
            <div class="quick-artist">${escHtml(item.artist)}</div>
          </div>
        </div>`;
    });
    container.innerHTML = html;
  }

  // â”€â”€ SYNTAX HIGHLIGHT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function syntaxHighlight(json) {
    return json
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, match => {
        if (/^"/.test(match)) {
          return /:$/.test(match)
            ? `<span class="jk">${match}</span>`
            : `<span class="js">${match}</span>`;
        }
        if (/true|false|null/.test(match)) return `<span class="jb">${match}</span>`;
        return `<span class="jn">${match}</span>`;
      });
  }

  function copyJson() {
    navigator.clipboard.writeText(JSON.stringify(window._lastJson, null, 2));
    document.querySelector('.copy-btn').textContent = 'âœ“ Copied!';
    setTimeout(() => document.querySelector('.copy-btn').textContent = 'Copy', 2000);
  }

  // â”€â”€ AUDIO PLAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function quickPlay(id, title, artist) {
    document.getElementById('videoId').value = id;
    playAudio(id, title, artist, '');
  }

  function playAudio(id, title, artist, thumb) {
    const playUrl = `${BASE}/play/${id}`;
    document.getElementById('currentUrl').textContent = playUrl;

    setupPlayer(playUrl, title, artist, thumb);

    // Juga fetch stream info untuk tampilkan di response
    fetchAndShow(`${BASE}/stream/${id}`);
  }

  function setupPlayer(src, title, artist, thumb) {
    audio.src = src;
    audio.play().catch(e => console.log('Autoplay blocked:', e));

    document.getElementById('playerTitle').textContent = title;
    document.getElementById('playerArtist').textContent = artist || 'YouTube Music';
    if (thumb) {
      document.getElementById('playerCover').innerHTML = `<img src="${thumb}">`;
    }
    document.getElementById('playerBar').classList.add('visible');
    document.getElementById('playBtn').textContent = 'â¸';
  }

  function togglePlay() {
    if (audio.paused) {
      audio.play();
      document.getElementById('playBtn').textContent = 'â¸';
    } else {
      audio.pause();
      document.getElementById('playBtn').textContent = 'â–¶';
    }
  }

  function seekBack()    { audio.currentTime = Math.max(0, audio.currentTime - 10); }
  function seekForward() { audio.currentTime = Math.min(audio.duration||0, audio.currentTime + 10); }
  function setVol(v)     { audio.volume = v; }

  function seekTo(e) {
    const rect = e.currentTarget.getBoundingClientRect();
    const pct = (e.clientX - rect.left) / rect.width;
    audio.currentTime = pct * (audio.duration || 0);
  }

  audio.addEventListener('timeupdate', () => {
    if (!audio.duration) return;
    const pct = (audio.currentTime / audio.duration) * 100;
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('timeNow').textContent = fmtTime(audio.currentTime);
    document.getElementById('timeDur').textContent = fmtTime(audio.duration);
  });

  audio.addEventListener('ended', () => {
    document.getElementById('playBtn').textContent = 'â–¶';
    document.getElementById('progressFill').style.width = '0%';
  });

  function fmtTime(s) {
    const m = Math.floor(s/60);
    const sec = Math.floor(s%60).toString().padStart(2,'0');
    return `${m}:${sec}`;
  }

  // â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setLoading(on) {
    const btn = document.getElementById('runBtn');
    const lbl = document.getElementById('runLabel');
    const spn = document.getElementById('spinner');
    btn.disabled = on;
    lbl.textContent = on ? 'Loading...' : 'â–¶ Jalankan';
    spn.style.display = on ? 'block' : 'none';
  }

  function escHtml(s) {
    return (s||'').replace(/'/g,'&#39;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  // Enter key support
  document.getElementById('searchQuery').addEventListener('keydown', e => {
    if (e.key === 'Enter') runSearch();
  });
  document.getElementById('videoId').addEventListener('keydown', e => {
    if (e.key === 'Enter') runEndpoint();
  });
</script>
</body>
</html>

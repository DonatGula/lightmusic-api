<!DOCTYPE html>
<html lang="id" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LightMusic API Explorer</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
[data-theme="dark"] {
  --bg:#0a0a0f; --bg2:#0f0f1a; --surface:#12121f; --card:#1a1a2e;
  --border:#2a2a4a; --border2:#3a3a6a;
  --accent:#00ff88; --accent2:#ff6b00; --accent3:#00cfff; --pink:#ff00aa; --yellow:#ffd700;
  --text:#c8ffc8; --text2:#88aa88; --muted:#445544;
  --success:#00ff88; --error:#ff4444;
  --glow:0 0 10px #00ff8866; --glow2:0 0 10px #ff6b0066; --glow3:0 0 10px #00cfff66;
  --scanline:repeating-linear-gradient(0deg,transparent,transparent 2px,#00000015 2px,#00000015 4px);
}
[data-theme="light"] {
  --bg:#f0ede0; --bg2:#e8e4d0; --surface:#ddd8c0; --card:#ccc8b0;
  --border:#aaa890; --border2:#888670;
  --accent:#006622; --accent2:#cc4400; --accent3:#004488; --pink:#880044; --yellow:#886600;
  --text:#1a2a1a; --text2:#445544; --muted:#889988;
  --success:#006622; --error:#cc2200;
  --glow:none; --glow2:none; --glow3:none; --scanline:none;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
  background:var(--bg); color:var(--text);
  font-family:'Share Tech Mono',monospace;
  display:grid; grid-template-columns:290px 1fr; grid-template-rows:60px 1fr;
  height:100vh; overflow:hidden; position:relative;
}

body::after{
  content:''; position:fixed; inset:0;
  background:var(--scanline); pointer-events:none; z-index:9999; opacity:0.4;
}
body::before{
  content:''; position:fixed; inset:0;
  background:radial-gradient(ellipse at center,transparent 60%,#00000088 100%);
  pointer-events:none; z-index:9998;
}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border2);}
*{scrollbar-width:thin;scrollbar-color:var(--border2) var(--bg);}

/* TOPBAR */
.topbar{
  grid-column:1/-1; background:var(--surface);
  border-bottom:2px solid var(--accent);
  display:flex; align-items:center; padding:0 16px; gap:12px;
  box-shadow:0 2px 20px #00ff8833; z-index:100;
}
.logo{
  font-family:'Orbitron',monospace; font-size:15px; font-weight:900;
  color:var(--accent); text-shadow:var(--glow); letter-spacing:2px;
  display:flex; align-items:center; gap:6px; white-space:nowrap;
}
.lb{color:var(--accent2);font-size:20px;text-shadow:var(--glow2);}
.url-bar{
  flex:1; background:var(--bg); border:1px solid var(--border2);
  padding:6px 12px; font-family:'Share Tech Mono',monospace;
  font-size:12px; color:var(--accent3); text-shadow:var(--glow3);
  overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
}
.url-bar::before{content:'> ';color:var(--accent);text-shadow:var(--glow);}
.theme-btn{
  background:var(--card); border:1px solid var(--border2);
  color:var(--text); padding:5px 12px;
  font-family:'Share Tech Mono',monospace; font-size:11px;
  cursor:pointer; letter-spacing:1px; transition:all 0.2s;
}
.theme-btn:hover{border-color:var(--accent);color:var(--accent);text-shadow:var(--glow);}
.dot{width:8px;height:8px;background:var(--accent);box-shadow:var(--glow);animation:blink 1.5s infinite;flex-shrink:0;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.2}}

/* SIDEBAR */
.sidebar{background:var(--surface);border-right:2px solid var(--border);overflow-y:auto;}
.sb{border-bottom:1px solid var(--border);padding:12px;}
.sbt{
  font-family:'Orbitron',monospace; font-size:9px; font-weight:700;
  color:var(--accent2); text-shadow:var(--glow2); letter-spacing:2px;
  margin-bottom:10px; display:flex; align-items:center; gap:6px;
}
.sbt::before{content:'//';color:var(--muted);}
.ri{
  width:100%; background:var(--bg); border:1px solid var(--border2);
  color:var(--accent3); padding:8px 10px;
  font-family:'Share Tech Mono',monospace; font-size:12px;
  outline:none; transition:border-color 0.2s,box-shadow 0.2s;
  margin-bottom:6px; text-shadow:var(--glow3);
}
.ri:focus{border-color:var(--accent3);box-shadow:var(--glow3);}
.ri::placeholder{color:var(--muted);}
.rs{
  width:100%; background:var(--bg); border:1px solid var(--border2);
  color:var(--text); padding:8px 10px;
  font-family:'Share Tech Mono',monospace; font-size:12px;
  outline:none; cursor:pointer; margin-bottom:6px;
}
.ep{
  display:flex; align-items:center; gap:8px; padding:8px;
  cursor:pointer; border:1px solid transparent; transition:all 0.15s; margin-bottom:3px;
}
.ep:hover{background:var(--card);border-color:var(--border2);}
.ep.active{background:var(--card);border-color:var(--accent);box-shadow:inset 2px 0 0 var(--accent);}
.em{
  font-family:'Orbitron',monospace; font-size:9px; font-weight:700;
  padding:2px 6px; letter-spacing:1px;
}
.get{color:var(--accent3);border:1px solid var(--accent3);text-shadow:var(--glow3);}
.ep-path{font-size:12px;color:var(--text);}
.ep-desc{font-size:10px;color:var(--muted);margin-top:1px;}
.rbtn{
  width:100%; background:var(--bg); border:2px solid var(--accent);
  color:var(--accent); padding:10px;
  font-family:'Orbitron',monospace; font-size:11px; font-weight:700;
  letter-spacing:2px; cursor:pointer; transition:all 0.2s;
  text-shadow:var(--glow); box-shadow:var(--glow);
}
.rbtn:hover:not(:disabled){background:var(--accent);color:var(--bg);text-shadow:none;box-shadow:none;}
.rbtn:disabled{opacity:0.4;cursor:not-allowed;}
.qs{
  display:flex; align-items:center; gap:8px; padding:7px 6px;
  cursor:pointer; border:1px solid transparent; transition:all 0.15s; margin-bottom:2px;
}
.qs:hover{background:var(--card);border-color:var(--accent2);}
.qs.playing{border-color:var(--accent);background:var(--card);}
.qn{font-family:'Orbitron',monospace;font-size:9px;color:var(--muted);width:16px;flex-shrink:0;}
.qs.playing .qn{color:var(--accent);animation:blink 1s infinite;}
.qt{font-size:11px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.qa{font-size:10px;color:var(--muted);}

/* MAIN */
.main{display:grid;grid-template-rows:1fr auto;overflow:hidden;background:var(--bg2);}
.resp{overflow-y:auto;padding:16px;}

/* Empty */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:16px;text-align:center;}
.big-sym{
  font-family:'VT323',monospace; font-size:80px;
  color:var(--accent); text-shadow:var(--glow); line-height:1;
  animation:flicker 5s infinite;
}
@keyframes flicker{0%,94%,100%{opacity:1}95%{opacity:0.3}96%{opacity:1}97%{opacity:0.5}98%{opacity:1}}
.big-sub{font-family:'VT323',monospace;font-size:24px;color:var(--accent2);text-shadow:var(--glow2);letter-spacing:4px;}
.big-hint{font-size:11px;color:var(--muted);letter-spacing:1px;}

/* Response */
.meta-row{display:flex;align-items:center;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
.rlabel{font-family:'Orbitron',monospace;font-size:10px;color:var(--accent2);letter-spacing:2px;}
.stag{padding:2px 8px;font-size:11px;font-family:'Orbitron',monospace;font-weight:700;letter-spacing:1px;}
.sok{color:var(--success);border:1px solid var(--success);text-shadow:var(--glow);}
.serr{color:var(--error);border:1px solid var(--error);}
.mpill{font-size:10px;color:var(--muted);border:1px solid var(--border);padding:2px 6px;}
.mpill span{color:var(--text2);}
.cbtn{
  margin-left:auto; background:none; border:1px solid var(--border2);
  color:var(--muted); font-family:'Share Tech Mono',monospace;
  font-size:10px; padding:3px 8px; cursor:pointer; letter-spacing:1px; transition:all 0.2s;
}
.cbtn:hover{color:var(--accent);border-color:var(--accent);}
.jw{
  background:var(--bg); border:1px solid var(--border);
  font-family:'Share Tech Mono',monospace; font-size:12.5px;
  line-height:1.7; padding:14px; overflow-x:auto; white-space:pre;
  animation:fin 0.3s ease; box-shadow:inset 0 0 30px #00000044;
}
@keyframes fin{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.jk{color:#00cfff;text-shadow:0 0 8px #00cfff55;}
.js{color:#aaffcc;}
.jn{color:#ffd700;text-shadow:0 0 6px #ffd70044;}
.jb{color:#ff6b6b;}

/* Search cards */
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:8px;margin-top:12px;animation:fin 0.3s ease;}
.scard{
  background:var(--card); border:1px solid var(--border);
  padding:10px; cursor:pointer; transition:all 0.15s; position:relative; overflow:hidden;
}
.scard::before{
  content:''; position:absolute; top:0; left:0; right:0; height:2px;
  background:linear-gradient(90deg,var(--accent),var(--accent3));
  transform:scaleX(0); transition:transform 0.2s;
}
.scard:hover{border-color:var(--accent);}
.scard:hover::before{transform:scaleX(1);}
.scard img{width:100%;aspect-ratio:1;object-fit:cover;margin-bottom:8px;display:block;}
.scard-placeholder{width:100%;aspect-ratio:1;background:var(--bg);margin-bottom:8px;display:flex;align-items:center;justify-content:center;font-size:36px;}
.scard-title{font-size:12px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px;}
.scard-artist{font-size:11px;color:var(--muted);}
.scard-btns{display:flex;gap:4px;margin-top:8px;}
.sbtn{
  flex:1; padding:4px; background:var(--bg); border:1px solid var(--border2);
  color:var(--text2); font-family:'Share Tech Mono',monospace;
  font-size:10px; cursor:pointer; transition:all 0.15s;
}
.sbtn.pb:hover{border-color:var(--accent);color:var(--accent);}
.sbtn.ib:hover{border-color:var(--accent3);color:var(--accent3);}

/* PLAYER */
.player{
  background:var(--surface); border-top:2px solid var(--accent);
  padding:10px 16px; display:none; flex-direction:column; gap:8px;
  box-shadow:0 -4px 20px #00ff8822;
}
.player.on{display:flex;}
.ptop{display:flex;align-items:center;gap:12px;}
.pthumb{
  width:44px;height:44px; background:var(--card); border:1px solid var(--border2);
  flex-shrink:0; display:flex; align-items:center; justify-content:center;
  font-size:22px; overflow:hidden; position:relative;
}
.pthumb img{width:100%;height:100%;object-fit:cover;}
.pthumb::after{content:'';position:absolute;inset:0;border:1px solid var(--accent);opacity:0.3;}
.pinfo{flex:1;min-width:0;}
.ptitle{font-size:13px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-shadow:var(--glow);}
.partist{font-size:11px;color:var(--muted);}
.pstatus{font-family:'Orbitron',monospace;font-size:9px;color:var(--accent2);letter-spacing:1px;margin-top:2px;text-shadow:var(--glow2);}
.pctrls{display:flex;align-items:center;gap:8px;}
.pc{
  background:none; border:1px solid var(--border2); color:var(--text2);
  font-size:12px; width:30px; height:30px; cursor:pointer;
  display:flex; align-items:center; justify-content:center; transition:all 0.15s;
}
.pc:hover{border-color:var(--accent);color:var(--accent);}
.pc.main{
  width:38px; height:38px; border:2px solid var(--accent);
  color:var(--accent); font-size:14px;
  text-shadow:var(--glow); box-shadow:var(--glow);
}
.pc.main:hover{background:var(--accent);color:var(--bg);text-shadow:none;box-shadow:none;}
.pprog{flex:1;}
.pbar{height:4px;background:var(--border);cursor:pointer;position:relative;margin-bottom:3px;}
.pfill{
  height:100%; background:var(--accent); box-shadow:var(--glow);
  width:0%; transition:width 0.1s linear; position:relative;
}
.pfill::after{
  content:''; position:absolute; right:-3px; top:-2px;
  width:8px; height:8px; background:var(--accent);
  border-radius:50%; box-shadow:var(--glow);
}
.trow{display:flex;justify-content:space-between;font-size:9px;color:var(--muted);font-family:'Orbitron',monospace;}
.vwrap{display:flex;align-items:center;gap:6px;}
.vi{font-size:12px;color:var(--muted);}
input[type=range].vol{
  -webkit-appearance:none; width:70px; height:3px;
  background:var(--border2); outline:none; cursor:pointer;
}
input[type=range].vol::-webkit-slider-thumb{
  -webkit-appearance:none; width:10px; height:10px;
  background:var(--accent); box-shadow:var(--glow);
}

/* Toast */
.toast{
  position:fixed; bottom:80px; right:16px;
  background:var(--card); border:1px solid var(--accent);
  color:var(--accent); font-size:12px; padding:8px 16px;
  z-index:9997; text-shadow:var(--glow); box-shadow:var(--glow);
  animation:tin 0.3s ease;
}
@keyframes tin{from{transform:translateX(100%);opacity:0}to{transform:none;opacity:1}}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="logo"><span class="lb">[</span>LIGHTMUSIC<span class="lb">]</span></div>
  <div class="url-bar" id="urlBar">ready...</div>
  <div class="dot"></div>
  <button class="theme-btn" id="themBtn" onclick="toggleTheme()">[ DARK ]</button>
</div>

<!-- SIDEBAR -->
<div class="sidebar">

  <div class="sb">
    <div class="sbt">SEARCH</div>
    <input class="ri" id="searchQ" type="text" placeholder="ketik lagu / artis..."/>
    <button class="rbtn" onclick="doSearch()">‚ñ∂ SEARCH</button>
  </div>

  <div class="sb">
    <div class="sbt">ENDPOINTS</div>
    <div class="ep active" data-ep="search" onclick="selEp(this,'search')">
      <span class="em get">GET</span>
      <div><div class="ep-path">/search</div><div class="ep-desc">Cari lagu & artis</div></div>
    </div>
    <div class="ep" data-ep="song" onclick="selEp(this,'song')">
      <span class="em get">GET</span>
      <div><div class="ep-path">/song/:id</div><div class="ep-desc">Detail metadata</div></div>
    </div>
    <div class="ep" data-ep="stream" onclick="selEp(this,'stream')">
      <span class="em get">GET</span>
      <div><div class="ep-path">/stream/:id</div><div class="ep-desc">URL stream audio</div></div>
    </div>
    <div class="ep" data-ep="lyrics" onclick="selEp(this,'lyrics')">
      <span class="em get">GET</span>
      <div><div class="ep-path">/lyrics/:id</div><div class="ep-desc">Lirik lagu</div></div>
    </div>
    <div class="ep" data-ep="charts" onclick="selEp(this,'charts')">
      <span class="em get">GET</span>
      <div><div class="ep-path">/charts</div><div class="ep-desc">Top chart</div></div>
    </div>
  </div>

  <div class="sb">
    <div class="sbt">PARAMS</div>
    <input class="ri" id="vidId" type="text" placeholder="video id..." value="kitkOTxGfjI"/>
    <select class="rs" id="ctry">
      <option value="ID">üáÆüá© Indonesia</option>
      <option value="US">üá∫üá∏ United States</option>
      <option value="JP">üáØüáµ Japan</option>
      <option value="KR">üá∞üá∑ South Korea</option>
      <option value="GB">üá¨üáß United Kingdom</option>
    </select>
    <button class="rbtn" id="runBtn" onclick="runEp()">‚ñ∂ EXECUTE</button>
  </div>

  <div class="sb">
    <div class="sbt">QUICK PLAY</div>
    <div class="qs" id="qs0" onclick="quickPlay('kitkOTxGfjI','Separuh Nafas','Dewa 19')">
      <div class="qn">01</div>
      <div><div class="qt">Separuh Nafas</div><div class="qa">Dewa 19</div></div>
    </div>
    <div class="qs" id="qs1" onclick="quickPlay('kXQRVbRfF4s','Yellow','Coldplay')">
      <div class="qn">02</div>
      <div><div class="qt">Yellow</div><div class="qa">Coldplay</div></div>
    </div>
    <div class="qs" id="qs2" onclick="quickPlay('5a0EkeqWNBs','Kangen','Dewa 19')">
      <div class="qn">03</div>
      <div><div class="qt">Kangen</div><div class="qa">Dewa 19</div></div>
    </div>
  </div>

</div>

<!-- MAIN -->
<div class="main">
  <div class="resp" id="respArea">
    <div class="empty">
      <div class="big-sym">‚ô´</div>
      <div class="big-sub">LIGHTMUSIC API</div>
      <div class="big-hint">// SELECT ENDPOINT OR SEARCH TO BEGIN</div>
    </div>
  </div>

  <div class="player" id="player">
    <div class="ptop">
      <div class="pthumb" id="pThumb">‚ô™</div>
      <div class="pinfo">
        <div class="ptitle" id="pTitle">‚Äî</div>
        <div class="partist" id="pArtist">‚Äî</div>
        <div class="pstatus" id="pStatus">STOPPED</div>
      </div>
      <div class="pctrls">
        <button class="pc" onclick="skip(-10)">‚èÆ</button>
        <button class="pc main" id="playBtn" onclick="togglePlay()">‚ñ∂</button>
        <button class="pc" onclick="skip(10)">‚è≠</button>
      </div>
      <div class="pprog">
        <div class="pbar" onclick="seekTo(event)">
          <div class="pfill" id="pFill"></div>
        </div>
        <div class="trow">
          <span id="tNow">0:00</span>
          <span id="tDur">0:00</span>
        </div>
      </div>
      <div class="vwrap">
        <span class="vi">‚ñ∂‚ñ∂</span>
        <input type="range" class="vol" min="0" max="1" step="0.05" value="0.8" oninput="audio.volume=this.value">
      </div>
    </div>
  </div>
</div>

<audio id="audioEl" preload="none"></audio>

<script>
const BASE = (location.hostname==='localhost'||location.hostname==='127.0.0.1')
  ? 'http://localhost:5000'
  : 'https://lightmusic.up.railway.app';

const audio = document.getElementById('audioEl');
audio.volume = 0.8;
let curEp = 'search', playingId = '', busy = false;

// Theme
let theme = 'dark';
function toggleTheme() {
  theme = theme==='dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', theme);
  document.getElementById('themBtn').textContent = `[ ${theme.toUpperCase()} ]`;
}

// Endpoint
function selEp(el, ep) {
  document.querySelectorAll('.ep').forEach(e=>e.classList.remove('active'));
  el.classList.add('active');
  curEp = ep;
}

// Run
async function runEp() {
  const vid = document.getElementById('vidId').value.trim();
  const q   = document.getElementById('searchQ').value.trim();
  const ctr = document.getElementById('ctry').value;
  let url   = BASE;
  switch(curEp) {
    case 'search':  url=`${BASE}/search?q=${encodeURIComponent(q||'dewa 19')}&type=songs`; break;
    case 'song':    url=`${BASE}/song/${vid}`; break;
    case 'stream':  url=`${BASE}/stream/${vid}`; break;
    case 'lyrics':  url=`${BASE}/lyrics/${vid}`; break;
    case 'charts':  url=`${BASE}/charts?country=${ctr}`; break;
  }
  const data = await hit(url);
  if (!data) return;
  renderJson(data, url);
  if (curEp==='search' && Array.isArray(data.data)) renderCards(data.data);
}

async function doSearch() {
  const q = document.getElementById('searchQ').value.trim();
  if (!q) return;
  const url = `${BASE}/search?q=${encodeURIComponent(q)}&type=songs`;
  const data = await hit(url);
  if (!data) return;
  renderJson(data, url);
  if (Array.isArray(data.data)) renderCards(data.data);
}

// Fetch
async function hit(url) {
  if (busy) return null;
  busy = true;
  setBusy(true);
  document.getElementById('urlBar').textContent = url.replace(BASE,'');
  const t = Date.now();
  try {
    const r = await fetch(url);
    const d = await r.json();
    d._m = { code: r.status, ms: Date.now()-t };
    return d;
  } catch(e) {
    toast('Fetch error: '+e.message);
    return null;
  } finally {
    busy = false;
    setBusy(false);
  }
}

// Render JSON
function renderJson(data, url) {
  const m = data._m||{};
  const c = {...data}; delete c._m;
  const ok = m.code>=200 && m.code<300 && data.status==='success';
  document.getElementById('respArea').innerHTML = `
    <div>
      <div class="meta-row">
        <span class="rlabel">// OUTPUT</span>
        <span class="stag ${ok?'sok':'serr'}">${ok?`‚úì ${m.code} OK`:`‚úó ${m.code||'ERR'}`}</span>
        <span class="mpill">${m.ms}ms</span>
        <span class="mpill">${JSON.stringify(c).length}<span> B</span></span>
        <button class="cbtn" onclick="copyJ()">[ COPY ]</button>
      </div>
      <div class="jw" id="jOut">${hl(JSON.stringify(c,null,2))}</div>
    </div>`;
  window._lj = c;
}

// Cards
function renderCards(items) {
  const wrap = document.createElement('div');
  wrap.className = 'cards';
  items.slice(0,12).forEach(it => {
    const d = document.createElement('div');
    d.className = 'scard';
    d.innerHTML = it.thumbnail
      ? `<img src="${it.thumbnail}" onerror="this.style.display='none'">`
      : `<div class="scard-placeholder">‚ô´</div>`;
    d.innerHTML += `
      <div class="scard-title">${esc(it.title)}</div>
      <div class="scard-artist">${esc(it.artist||'')}</div>
      <div class="scard-btns">
        <button class="sbtn pb" onclick="quickPlay('${it.id}','${esc(it.title)}','${esc(it.artist||'')}')">‚ñ∂ PLAY</button>
        <button class="sbtn ib" onclick="infoOf('${it.id}')">‚Ñπ INFO</button>
      </div>`;
    wrap.appendChild(d);
  });
  document.getElementById('respArea').appendChild(wrap);
}

// Play
async function quickPlay(id, title, artist) {
  if (playingId===id && !audio.paused) { audio.pause(); return; }

  document.querySelectorAll('.qs').forEach(e=>e.classList.remove('playing'));
  const quick = document.querySelector(`.qs[id*="${id}"]`);
  if (quick) quick.classList.add('playing');

  document.getElementById('pTitle').textContent  = title;
  document.getElementById('pArtist').textContent = artist;
  document.getElementById('pStatus').textContent = 'LOADING...';
  document.getElementById('player').classList.add('on');
  document.getElementById('playBtn').textContent = '...';
  document.getElementById('playBtn').disabled = true;

  try {
    const r = await fetch(`${BASE}/stream/${id}`);
    const d = await r.json();

    if (d.status!=='success' || !d.data?.stream_url) {
      throw new Error(d.message||'Stream URL kosong');
    }

    // Update thumb
    if (d.data.thumbnail) {
      document.getElementById('pThumb').innerHTML =
        `<img src="${d.data.thumbnail}" onerror="this.parentElement.textContent='‚ô™'">`;
    }

    playingId = id;

    // Reset audio sepenuhnya
    audio.pause();
    audio.src = '';
    audio.load();

    await new Promise(r => setTimeout(r, 150));

    audio.src = d.data.stream_url;

    await new Promise((resolve, reject) => {
      const onCanPlay = () => { cleanup(); resolve(); };
      const onError   = () => { cleanup(); reject(new Error('Format tidak didukung')); };
      const cleanup   = () => { audio.removeEventListener('canplay', onCanPlay); audio.removeEventListener('error', onError); };
      audio.addEventListener('canplay', onCanPlay);
      audio.addEventListener('error', onError);
      audio.load();
    });

    await audio.play();
    document.getElementById('pStatus').textContent = 'NOW PLAYING';
    document.getElementById('playBtn').textContent = '‚è∏';

  } catch(e) {
    document.getElementById('pStatus').textContent = 'ERROR';
    document.getElementById('playBtn').textContent = '‚ñ∂';
    toast(e.message.includes('interact')||e.message.includes('play')
      ? 'Klik ‚ñ∂ untuk mulai putar'
      : 'Error: '+e.message);
  } finally {
    document.getElementById('playBtn').disabled = false;
  }
}

async function infoOf(id) {
  document.getElementById('vidId').value = id;
  const url = `${BASE}/song/${id}`;
  const d = await hit(url);
  if (d) renderJson(d, url);
}

function togglePlay() {
  if (!audio.src || audio.src===location.href) { toast('Pilih lagu dulu!'); return; }
  if (audio.paused) {
    audio.play()
      .then(()=>{ document.getElementById('playBtn').textContent='‚è∏'; document.getElementById('pStatus').textContent='NOW PLAYING'; })
      .catch(e=>toast('Play: '+e.message));
  } else {
    audio.pause();
    document.getElementById('playBtn').textContent='‚ñ∂';
    document.getElementById('pStatus').textContent='PAUSED';
  }
}

function skip(s) { audio.currentTime = Math.max(0,Math.min(audio.duration||0, audio.currentTime+s)); }
function seekTo(e) {
  if (!audio.duration) return;
  const r = e.currentTarget.getBoundingClientRect();
  audio.currentTime = ((e.clientX-r.left)/r.width)*audio.duration;
}

audio.addEventListener('timeupdate', () => {
  if (!audio.duration) return;
  document.getElementById('pFill').style.width = (audio.currentTime/audio.duration*100)+'%';
  document.getElementById('tNow').textContent = fmt(audio.currentTime);
  document.getElementById('tDur').textContent = fmt(audio.duration);
});
audio.addEventListener('ended', () => {
  document.getElementById('playBtn').textContent='‚ñ∂';
  document.getElementById('pStatus').textContent='STOPPED';
  document.getElementById('pFill').style.width='0%';
  document.querySelectorAll('.qs').forEach(e=>e.classList.remove('playing'));
  playingId='';
});
audio.addEventListener('error', () => {
  if (!audio.src || audio.src===location.href) return;
  document.getElementById('pStatus').textContent='ERROR';
  document.getElementById('playBtn').textContent='‚ñ∂';
  toast('Audio error ‚Äî coba lagu lain');
});

// Utils
function fmt(s){if(!s||isNaN(s))return'0:00';return`${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,'0')}`;}
function esc(s){return(s||'').replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");}
function hl(j){
  return j.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,m=>{
      if(/^"/.test(m)) return/:$/.test(m)?`<span class="jk">${m}</span>`:`<span class="js">${m}</span>`;
      if(/true|false|null/.test(m)) return`<span class="jb">${m}</span>`;
      return`<span class="jn">${m}</span>`;
    });
}
function copyJ(){ if(!window._lj)return; navigator.clipboard.writeText(JSON.stringify(window._lj,null,2)).then(()=>toast('Copied!')); }
function setBusy(on){ const b=document.getElementById('runBtn'); b.disabled=on; b.textContent=on?'// LOADING...':'‚ñ∂ EXECUTE'; }
function toast(msg){
  const el=document.createElement('div'); el.className='toast'; el.textContent=msg;
  document.body.appendChild(el); setTimeout(()=>el.remove(),3000);
}
document.getElementById('searchQ').addEventListener('keydown',e=>{if(e.key==='Enter')doSearch();});
document.getElementById('vidId').addEventListener('keydown',e=>{if(e.key==='Enter')runEp();});
</script>
</body>
</html>